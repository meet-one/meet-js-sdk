<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <title>E2E Testing - EOS</title>

    <!-- necessary import -->
    <script src="../../dist/meet-js-sdk.umd.js"></script>
    <script src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.9/lib/eos.js"></script>
    <script src="./script.js"></script>
    <link rel="stylesheet" href="./style.css" />

    <script>
      var eos = meetwallet.blockchain.getEos()
    </script>

    <script>
      eosSignProvider = async e => {
        executing(e)
        try {
          let account = meetwallet.blockchain.account
          let res = await eos.transaction({
            actions: [
              {
                account: 'eosio.token',
                name: 'transfer',
                authorization: [
                  {
                    actor: account.name, // creator
                    permission: account.authority
                  }
                ],
                data: {
                  from: account.name, // creator
                  to: 'g.f.w',
                  quantity: '0.0001 EOS',
                  memo: 'js-sdk signProvider'
                }
              }
            ],
            options: {
              broadcast: true
            }
          })
          if (res.transaction_id) {
            success(e)
          } else {
            failed(e)
          }
        } catch (error) {
          failed(e)
          console.log(error)
        }
      }

      transaction = async e => {
        executing(e)
        try {
          let account = meetwallet.blockchain.account
          let res = await meetwallet.blockchain.transaction(
            [
              {
                account: 'eosio.token',
                name: 'transfer',
                authorization: [
                  {
                    actor: account.name, // creator
                    permission: account.authority
                  }
                ],
                data: {
                  from: account.name, // creator
                  to: 'g.f.w',
                  quantity: '0.0001 EOS',
                  memo: 'js-sdk transaction'
                }
              }
            ],
            'it works?',
            undefined
          )
          if (res.code === 0 && res.data.transaction_id) {
            success(e)
          } else {
            failed(e)
          }
        } catch (error) {
          failed(e)
          console.error(error)
        }
      }

      transfer = async e => {
        executing(e)
        try {
          let res = await meetwallet.blockchain.transfer(
            'g.f.w',
            0.0001,
            'Transfer Memo',
            'Order Info'
          )
          if (res.code === 0 && res.data.transaction_id) {
            success(e)
          } else {
            failed(e)
          }
        } catch (error) {
          failed(e)
          console.error(error)
        }
      }

      transferMEETONE = async e => {
        executing(e)
        try {
          let res = await meetwallet.blockchain.transfer(
            'g.f.w',
            0.0001,
            'Transfer Memo',
            'Order Info',
            { tokenName: 'MEETONE', contract: 'eosiomeetone' }
          )
          if (res.code === 0 && res.data.transaction_id) {
            success(e)
          } else {
            failed(e)
          }
        } catch (error) {
          failed(e)
          console.error(error)
        }
      }

      getIdentity = async e => {
        executing(e)
        try {
          let res = await meetwallet.blockchain.getIdentity()
          if (typeof meetwallet.blockchain.account !== 'undefined') {
            if (meetwallet.blockchain.account.chainType.toLowerCase() === 'eos') {
              success(e)
              return
            }
            failed(e)
          } else {
            failed(e)
          }
        } catch (error) {
          failed(e)
          console.error(error)
        }
      }
    </script>
  </head>
  <body>
    <h1>Tests - EOS</h1>

    <button onClick="runAllTests();">Run All Tests</button>

    <div class="tests">
      <div>
        <h2>getIdentity</h2>
        <button onClick="getIdentity(event);">Test</button>
      </div>
      <div>
        <h2>EosSignProvider</h2>
        <button onClick="eosSignProvider(event);">Test</button>
      </div>
      <div>
        <h2>Transaction</h2>
        <button onClick="transaction(event);">Test</button>
      </div>
      <div>
        <h2>Transfer - EOS</h2>
        <button onClick="transfer(event);">Test</button>
      </div>
      <div>
        <h2>Transfer - MEETONE</h2>
        <button onClick="transferMEETONE(event);">Test</button>
      </div>
    </div>
  </body>
</html>
